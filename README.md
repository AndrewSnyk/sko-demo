# Secure AI Development Advanced (201) Workshop

Welcome to the Secure AI Development Advanced workshop! In this hands-on session, you'll learn advanced techniques for building applications with AI coding assistants while maintaining security best practices.

## Workshop Overview

**Duration**: 30 minutes  
**Level**: Intermediate (requires completion of 101 workshop)

### What You'll Learn

1. **AGENTS.md** - How to use the open-standard AGENTS.md file to automatically enforce code quality, security, and compliance guidelines
2. **Cloud Agents** - When to use Cursor's Cloud Agents vs. local agents, and the security implications of each
3. **Best-of-N** - How to run the same prompt across multiple AI models in parallel to compare outputs and pick the best solution

---

## Prerequisites

Before starting, make sure you have:

- [ ] **Cursor** installed ([download](https://cursor.com))
- [ ] **Snyk Extension** installed in Cursor
- [ ] **Node.js** (v18 or later) and npm installed
- [ ] Completed the **Secure AI Development Foundations (101)** workshop

---

## Getting Started

### 1. Clone the Repository

```bash
git clone <repository-url>
cd secure-ai-dev-advanced-workshop
```

### 2. Install Dependencies

```bash
npm install
```

### 3. Start the Server

```bash
npm start
```

### 4. Verify It's Working

Open your browser to [http://localhost:3000](http://localhost:3000) - you should see the "Hello, World!" page.

You can also check the health endpoint: [http://localhost:3000/api/health](http://localhost:3000/api/health)

---

## Section 1: Using AGENTS.md to Improve Code Quality

### What is AGENTS.md?

AGENTS.md is an open-standard Markdown file that provides instructions to AI coding agents. When placed at the root of your project, agents like Cursor will automatically read and follow these guidelines.

**Key benefits:**
- Works across multiple AI tools (Cursor, Windsurf, Kilo Code, etc.)
- Simple Markdown format - no special syntax
- Version-controlled alongside your code
- Team-wide consistency

### Explore the AGENTS.md File

Open `AGENTS.md` in this project. Notice the different sections:

- **Code Quality Standards** - JSDoc comments, async/await, input validation
- **Security Guidelines** - No logging sensitive data, parameterized queries
- **Compliance Guidelines** - License restrictions (no GPL)

### Exercise: See AGENTS.md in Action

Try this prompt in Cursor's agent:

```
Add a user registration endpoint at POST /api/register that accepts email and password, validates the input, and returns a user object with an ID
```

**Watch for:**
- Automatic JSDoc comments
- Input validation
- No password logging
- Async/await usage

### Your Turn

Try adding another endpoint:

```
Add a password reset endpoint at POST /api/reset-password that accepts an email address, validates it, and returns a success message
```

---

## Section 2: Cloud Agents and Security Implications

### Types of Agents in Cursor

| Agent Type | Where It Runs | Security Features |
|------------|---------------|-------------------|
| **Main Agent** | Your laptop | Full access to extensions, AGENTS.md, MCP |
| **Local Subagents** | Your laptop (parallel) | Same as main agent |
| **Cloud Agents** | Cursor's AWS VMs | Limited - no extensions, AGENTS.md has known issues |

### When to Use Each

**Use Local Agents when:**
- You need real-time Snyk scanning
- You want AGENTS.md enforced
- Interactive coding sessions

**Use Cloud Agents when:**
- Long-running tasks (30+ minutes)
- You want to close your laptop
- Heavy CI/test runs
- **AND** you have Snyk in your PR/CI pipeline

### Critical Security Consideration

Cloud Agents run in isolated VMs and do **NOT** have access to:
- Your local Cursor extensions (including Snyk)
- Your AGENTS.md file (known bug)
- MCP servers configured locally

**This means code generated by Cloud Agents bypasses IDE-level security scanning.**

### Defense-in-Depth Recommendation

When using Cloud Agents, implement additional security layers:

1. **PR-Level Scanning**: Integrate Snyk into GitHub/GitLab PR checks
2. **CI/CD Pipeline**: Run `snyk code test` and `snyk test` in CI
3. **Bugbot**: Use Snyk's Bugbot for automated PR security review

---

## Section 3: Best-of-N - Multiple Models for Better Output

### What is Best-of-N?

Best-of-N lets you run the same prompt across multiple AI models in parallel. Each model works in its own isolated git worktree, and you can compare the results side-by-side to pick the best solution.

### How to Use Best-of-N

1. Write your prompt in the agent input
2. Click the **"1x"** button next to the model selector
3. Select **"Multiple models"**
4. Choose which models to run (e.g., Claude, GPT-4, Gemini)
5. Submit the prompt
6. Compare the output cards side-by-side
7. Click **"Apply"** on the best result

### When to Use Best-of-N

| Use Case | Why It Helps |
|----------|--------------|
| Hard problems | Different models take different approaches |
| Security-critical code | Multiple "reviewers" catch different issues |
| Comparing code quality | See which model writes cleaner code |
| Learning model strengths | Understand which models work best for your codebase |

### Exercise: Try Best-of-N

Use Best-of-N with 2-3 models on this prompt:

```
Create a rate limiting middleware that limits requests to 100 per minute per IP address
```

**Compare the outputs:**
- Which solution is most readable?
- Which handles edge cases better?
- Which would you choose for production?

---

## Key Takeaways

1. **AGENTS.md** provides a simple, portable way to enforce code quality and security standards across your team

2. **Cloud Agents** are powerful for async work, but bypass IDE security - always have Snyk in your PR/CI pipeline as backup

3. **Best-of-N** improves output quality by comparing multiple model approaches, especially for hard or security-critical problems

---

## Troubleshooting

### Server won't start

```bash
# Make sure you're in the right directory
cd secure-ai-dev-advanced-workshop

# Reinstall dependencies
rm -rf node_modules
npm install

# Start the server
npm start
```

### AGENTS.md not being followed

- Verify the file is named exactly `AGENTS.md` (uppercase)
- Check it's in the project root directory
- Start a new agent session

### Snyk extension not scanning

1. Open Extensions panel (Cmd/Ctrl+Shift+X)
2. Search for "Snyk" and verify it's installed
3. Authenticate: Cmd/Ctrl+Shift+P â†’ "Snyk: Authenticate"

### Best-of-N not showing multiple options

- Ensure you clicked "1x" and selected "Multiple models"
- Some models may require specific subscription tiers
- Check your Cursor plan supports parallel agents

---

## Additional Resources

- [Cursor Documentation](https://cursor.com/docs)
- [AGENTS.md Specification](https://agents.md/)
- [Snyk Documentation](https://docs.snyk.io)
- [Snyk + Cursor Integration](https://snyk.io/integrations)

---

## Next Steps

After this workshop, consider:

1. Adding AGENTS.md to your own projects
2. Setting up Snyk in your CI/CD pipeline
3. Experimenting with Best-of-N on complex refactoring tasks
4. Sharing these techniques with your team

Happy coding! ðŸš€
